<div class="row">
	<div class="col-md-4">
		<div class="well revenue">
	      	<h4>Recaudación total:</h4>
	      	<p class="revenue-price"><strong><%= number_to_currency(@total_amount, currency: ' $', separator: ',', delimeter: '.', precision: 0) %></strong></p>
	    </div>
	</div>
	<div class="col-md-4">
		<div class="well revenue">
	      	<h4>Recaudación por Servicios:</h4>
	      	<p class="revenue-price"><strong><%= number_to_currency(@services_amount, currency: ' $', separator: ',', delimeter: '.', precision: 0) %></strong></p>
	    </div>
	</div>
	<div class="col-md-4">
		<div class="well revenue">
	      	<h4>Recaudación por Productos:</h4>
	      	<p class="revenue-price"><strong><%= number_to_currency(@products_amount, currency: ' $', separator: ',', delimeter: '.', precision: 0) %></strong></p>
	    </div>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		
		<table>
			<tr>
				<th>
					Servicio
				</th>
				<% @service_providers.each do |provider| %>
				<th>
					<%= provider.public_name %>
				</th>
				<% end %>
			</tr>
			<% @services.each do |service| %>
				<tr>
					<td>
						<%= service.name %>
					</td>
					<% @service_providers.each do |provider| %>

						<%
								bookings = Booking.where.not(status_id: @status_cancelled_id).where(service_provider_id: provider.id, start: @from.beginning_of_day..@to.end_of_day, service_id: service.id)

					    		bookings_count = bookings.count

					    		bookings_prices = bookings.sum(:price)

					    		service_commission = ServiceCommission.where(service_provider_id: provider.id, service_id: service.id).first

					    		commission = ""

					    		if !service_commission.nil?
					    			if service_commission.is_percent
					    				commission = service_commission.amount.to_s + " %"
					    			else
					    				commission = "$ " + service_commission.amount.to_s
					    			end
					    		else
					    			if service.comission_option == 0
					    				commission = service.comission_value.to_s + " %"
					    			else
					    				commission = "$ " + service.comission_value.to_s
					    			end
					    		end

				    	%>
				    	<td>
				    		Cantidad: <%= bookings_count %><br />
				    		Recaudación: <%= bookings_prices %><br />
				    		Comisión: <%= commission %>
				    	</td>

			    	<% end %>
		    	</tr>
		    <% end %>
	    </table>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<%= line_chart (provider_sales(@service_providers.pluck(:id), @from, @to)) %>
	</div>
</div>
<div class="row">
  <div class="col-md-6">
    <%= pie_chart provider_sales_type_pie(@service_providers.pluck(:id), @from, @to), library: { title: "Ranking de recaudaciones" } %>
  </div>
  <div class="col-md-6">
  	<%= pie_chart provider_commissions_pie(@service_providers.pluck(:id), @from, @to), library: { title: "Ranking de comisiones" } %>
  </div>
</div>