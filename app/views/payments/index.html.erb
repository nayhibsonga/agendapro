<!-- Chartkick se usa antes de q se carge la pagina -->
<script type="text/javascript">
  var Chartkick = {"language": "es"};
</script>
<%= javascript_include_tag "//www.google.com/jsapi", "chartkick" %>

<%= content_tag "div", id: "products_data", data: { products: Product.where(company_id: current_user.company_id).to_json } do %>
<% end %>

<div class="container-fluid">
  <div class="row report-control-row" style="margin-top: 20px;">
    <div class="col-sm-10">
      <div class="form-group">
        <label for="from" class="col-sm-1 control-label">Desde:</label>
        <div class="col-sm-5">
          <input type="text" id="from" name="from" class="form-control payments_select" value="<%= Time.now.strftime("%Y-%m-%d") %>">
        </div>
        <label for="from" class="col-sm-1 control-label">Hasta:</label>
        <div class="col-sm-5">
          <input type="text" id="to" name="to" class="form-control payments_select" value="<%= Time.now.strftime("%Y-%m-%d") %>">
        </div>
      </div>
      <div class="form-group">
        <label for="location_ids[]" class="col-sm-1 control-label" style="margin-top: 20px;">Locales:</label><br />
        <div class="col-sm-3">
          <% for location in Location.where(company_id: current_user.company_id, active: true).accessible_by(current_ability) do %>
            <label class="checkbox-inline" style="margin-top: 20px;">
              <%= check_box_tag 'location_ids[]', location.id, params[:location_ids].blank? ? true : params[:location_ids] && params[:location_ids].includes(location.id), {class: "payments_select payment_location"} %>
              <%= location.name.humanize %>
            </label><br />
          <% end %>
        </div>
        <label for="payment_method_ids[]" class="col-sm-1 control-label" style="margin-top: 20px;">Tipo:</label>
        <div class="col-sm-3">
          <% for payment_method in PaymentMethod.all do %>
            <label class="checkbox-inline" style="margin-top: 20px;">
              <%= check_box_tag 'payment_method_ids[]', payment_method.id, params[:payment_method_ids].blank? ? true : params[:payment_method_ids] && params[:payment_method_ids].includes(payment_method.id), {class: "payments_select payment_method"} %>
              <%= payment_method.name.humanize %>
            </label>
          <% end %>
        </div>
        <label for="payment_method_ids[]" class="col-sm-1 control-label" style="margin-top: 20px;">Cajero:</label>
        <div class="col-sm-3">
          <% for cashier in current_user.company.cashiers do %>
            <label class="checkbox-inline" style="margin-top: 20px;">
              <%= check_box_tag 'cashier_ids[]', cashier.id, params[:cashier_ids].blank? ? true : params[:cashier_ids] && params[:cashier_ids].includes(cashier.id), {class: "payments_select payment_cashier"} %>
              <%= payment_method.name.humanize %>
            </label>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-sm-2">
      <div class="form-group">
        <!--<a class='btn btn-green' id="new_payment_button" onclick="loadPayment(0);"><i class="fa fa-plus">Â </i> Nuevo Pago</a>-->
        <%= link_to '<i class="fa fa-dollar"></i> Agregar Pago'.html_safe, '#', class: "btn btn-green", id: "createPaymentBtn" %>
      </div>
    </div>
  </div>
  <div class="row" style="border-top: 1px solid #e3e3e3; margin-top: 10px;">
    <div class="col-sm-12">
      <div id='render_content'>
      </div>
    </div>
  </div>
</div>

<%= render :partial => 'payment_modals', :locals => {:company => current_user.company} %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "payments" %>
<% end %>

<% content_for :scripts do %>
  <%= javascript_include_tag "payment_index" %>
  <script type="text/javascript">
  $(function() {
    $('#new_payment').validate({
      errorPlacement: function(error, element) {
        error.appendTo(element.next());
      },
      rules: {
        'payment[payment_date]': {
          required: true
        }
      },
      highlight: function(element) {
        $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
        $(element).parent().children('.form-control-feedback').removeClass('fa fa-check').addClass('fa fa-times');
      },
      success: function(element) {
        $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
        $(element).parent().parent().children('.form-control-feedback').removeClass('fa fa-times').addClass('fa fa-check');
        $(element).parent().empty()
      },
      submitHandler: function(form) {
        $('#save_payment_button').attr('disabled', true);
        $("#save_payment_button").html('<i class="fa fa-spinner fa-spin"></i>');
        savePayment();

        return false;
      }
    });
  });
  </script>
<% end %>