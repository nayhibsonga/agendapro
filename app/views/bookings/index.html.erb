<div class="container-fluid background-grey">
  <div class="row">
    <div class="col-sm-6">
      <div class="row">
        <div class="col-sm-3">
          <label class="control-label label-calendar">Elige Local:</label>
        </div>
        <div class="col-sm-9">
          <select class="form-control" id="locals-selector" name="localSelector">
            <% @locations.each do |location| %>
              <option value="<%= location.id %>" data-minhour="<%= location.location_times.order(:open).first.open.strftime('%H:%M') %>" data-maxhour="<%= location.location_times.order(:close).last.close.strftime('%H:%M') %>" data-closed-days="<%= location.closed_days_zero_index %>"><%= location.name %></option>
            <% end %>
          </select>
        </div>
      </div>
    </div>
    <div class="col-sm-6">
      <div class="row">
        <div class="col-sm-3">
          <label class="control-label label-calendar">Elige Prestador:</label>
        </div>
        <div class="col-sm-9">
          <div id="providers-div">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<input type="hidden" id="from" value="<%= DateTime.now.strftime('%d/%m/%Y %R') %>" />
<input type="hidden" id="to" value="<%= (DateTime.now - 1.months).strftime('%d/%m/%Y %R') %>" />


<%= content_tag "div", id: "calendar-data", data: { calendar_duration: @company_setting.calendar_duration, extended_schedule: @company_setting.extended_schedule_bool, extended_min_hour: @company_setting.extended_min_hour.strftime('%H:%M'), extended_max_hour: @company_setting.extended_max_hour.strftime('%H:%M'), booking_history: @company_setting.booking_history, staff_code: @company_setting.staff_code, deal_identification_number: @company_setting.deal_identification_number, deal_required: @company_setting.deal_required, preset_notes: @company_setting.preset_notes, strict_booking: @company_setting.strict_booking, id_number: @company_setting.use_identification_number } do %>
<% end %>

<%= content_tag "div", id: "products_data", data: { products: Product.where(company_id: current_user.company_id).to_json } do %>
<% end %>

<%= content_tag "div", id: "groups_data", data: { provider_groups: @provider_groups } do %>
<% end %>

<%= content_tag :div, nil, id: "provider_available", data: { provider_available: @provider_available } %>

<% content_for :calendar do %>
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-2">
        <div id="dp"></div>
        <input type="hidden" id="set-date" />
        <button type="button" id="set-date-button" class="btn btn-green btn-block set-date-btn">Ir a fecha..</button>
        <button type="button" class="btn btn-green btn-block hours-optimizer-button" data-toggle="modal" data-target="#hoursOptimizer">Buscador de Horas</button>
        <div class="col-xs-2 calendar-alert">
          <div id="bookingAlerts" class="alert alert-warning" style="display: none;">
            <button id="bookingAlertsClose" type="button" class="close">&times;</button>
            <strong>Â¡Advertencia!</strong><br /><span id="bookingWarnings"></span>
          </div>
          <% if notice %>
            <div class="alert alert-info alert-dismissable fade in">
              <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
              <%= notice %>
            </div>
          <% end %>
          <% if alert %>
            <div class="alert alert-warning alert-dismissable fade in">
              <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
              <%= alert %>
            </div>
          <% end %>
        </div>
      </div>
      <div class="col-xs-10">
        <div id="popover" class="popover popover-right"></div>
        <div id="open-day-popover" class="popover popover-right"><a id="openDayClosePopover" class="closePopover"><i class="fa fa-times"></i></a><br /><a id="openDayPopoverBtn" class="actionPopover">Abrir horario</a></div>
        <div class="calendar-btn">
          <button type="button" class="btn btn-white" data-toggle="collapse" data-target="#calendarBtns" aria-expanded="false">
            Opciones <i class="fa fa-chevron-down"></i>
          </button>
          <div class="collapse" id="calendarBtns">
            <ul class="list-unstyled">
              <li><%= link_to '<i class="fa fa-calendar"></i> Agregar Reserva'.html_safe, '#', id: "createBooking" %></li>
              <li><%= link_to '<i class="fa fa-times"></i> Bloquear Horario'.html_safe, '#', id: "createBreak" %></li>
              <% if Role.where(name: ["Administrador General", "Administrador Local", "Recepcionista"]).include?(current_user.role) %>
                <li><%= link_to '<i class="fa fa-dollar"></i> Agregar Pago'.html_safe, '#', id: "createPaymentBtn" %></li>
              <% end %>
            </ul>
          </div>
        </div>
        <div id='calendar'></div>
      </div>
    </div>
  </div>
<% end %>

<input type="hidden" id="is_edit_modal" value="0" />

<% content_for :modals do %>
  <div class="modal fade" id="bookingModal" role="dialog" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title booking-modal-title" id="bookingModalLabel"></h4>
        </div>
        <div class="modal-body booking-modal-body">
            <div class="row well well-sm">
              <ul id="myTab" class="nav nav-tabs" role="tablist">
                <li id="booking-li" class="active"><a href="#booking-pane" role="tab" data-toggle="tab" class="tab_index" id="booking-tab">Reserva</a></li>
                <% if Role.where(name: ["Administrador General", "Administrador Local", "Recepcionista"]).include?(current_user.role) %>
                <li id="payments-li" class=""><a href="#payments-pane" role="tab" data-toggle="tab" class="tab_index" id="payments-tab">Pago</a></li>
                <% end %>
                <li id="client-payments-li" class=""><a href="#client-payments-pane" role="tab" data-toggle="tab" class="tab_index" id="client-payments-tab">Historial de pagos</a></li>
                <li id="client-li" class=""><a href="#client-pane" role="tab" data-toggle="tab" class="tab_index" id="client-tab">Cliente</a></li>
                <% if current_user.company.is_plan_capable("Premium") %>
                  <li id="charts-li" class=""><a href="#charts-pane" role="tab" data-toggle="tab" class="tab_index" id="charts-tab">Ficha</a></li>
                <% end %>
                <li id="history-li" class=""><a href="#history-pane" role="tab" data-toggle="tab" class="tab_index" id="history-tab">Historial Cliente</a></li>
                <% if @company_setting.booking_history %>
                <li id="changes-li" class=""><a href="#changes-pane" role="tab" data-toggle="tab" class="tab_index" id="changes-tab">Historial Reserva</a></li>
                <% end %>
              </ul>
              <br />
              <div id="myTabContent" class="tab-content">
                <div class="tab-pane active" id="booking-pane">
                <%= form_for @booking, html: {class: "form-horizontal"} do |f| %>
                  <%= f.hidden_field :max_changes, value: Company.find(current_user.company_id).company_setting.max_changes %>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group has-feedback">
                        <label for="datePicker" class="col-sm-4 control-label">Fecha</label>
                        <div class="col-sm-8">
                          <input type="text" id="datePicker" class="form-control" name="datePicker" placeholder="31/12/2014 (requerido)">
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                        </div>
                      </div>
                      <div class="form-group has-feedback">
                        <label class="col-sm-4 control-label">Hora</label>
                        <div class="col-sm-8">
                          <div class="input datetime required booking_start_end ">
                            <select class="form-control date-select datetime required" id="bookingStartHour" name="booking[start_hours]">
                              <option value="00">00</option>
                              <option value="01">01</option>
                              <option value="02">02</option>
                              <option value="03">03</option>
                              <option value="04">04</option>
                              <option value="05">05</option>
                              <option value="06">06</option>
                              <option value="07">07</option>
                              <option value="08">08</option>
                              <option value="09">09</option>
                              <option value="10">10</option>
                              <option value="11">11</option>
                              <option value="12">12</option>
                              <option value="13">13</option>
                              <option value="14">14</option>
                              <option value="15">15</option>
                              <option value="16">16</option>
                              <option value="17">17</option>
                              <option value="18">18</option>
                              <option value="19">19</option>
                              <option value="20">20</option>
                              <option value="21">21</option>
                              <option value="22">22</option>
                              <option value="23">23</option>
                            </select>
                            :<select class="form-control date-select datetime required" id="bookingStartMinute" name="booking[start_minutes]">
                              <option value="00">00</option>
                              <option value="05">05</option>
                              <option value="10">10</option>
                              <option value="15">15</option>
                              <option value="20">20</option>
                              <option value="25">25</option>
                              <option value="30">30</option>
                              <option value="35">35</option>
                              <option value="40">40</option>
                              <option value="45">45</option>
                              <option value="50">50</option>
                              <option value="55">55</option>
                            </select> -
                            <select class="form-control date-select datetime required" id="bookingEndHour" name="booking[end_hours]">
                              <option value="00">00</option>
                              <option value="01">01</option>
                              <option value="02">02</option>
                              <option value="03">03</option>
                              <option value="04">04</option>
                              <option value="05">05</option>
                              <option value="06">06</option>
                              <option value="07">07</option>
                              <option value="08">08</option>
                              <option value="09">09</option>
                              <option value="10">10</option>
                              <option value="11">11</option>
                              <option value="12">12</option>
                              <option value="13">13</option>
                              <option value="14">14</option>
                              <option value="15">15</option>
                              <option value="16">16</option>
                              <option value="17">17</option>
                              <option value="18">18</option>
                              <option value="19">19</option>
                              <option value="20">20</option>
                              <option value="21">21</option>
                              <option value="22">22</option>
                              <option value="23">23</option>
                            </select>
                            :<select class="form-control date-select datetime required" id="bookingEndMinute" name="booking[end_minutes]">
                              <option value="00">00</option>
                              <option value="05">05</option>
                              <option value="10">10</option>
                              <option value="15">15</option>
                              <option value="20">20</option>
                              <option value="25">25</option>
                              <option value="30">30</option>
                              <option value="35">35</option>
                              <option value="40">40</option>
                              <option value="45">45</option>
                              <option value="50">50</option>
                              <option value="55">55</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="form-group has-feedback">
                        <%= f.label :service_provider_id, "Prestador de servicios", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <%= f.collection_select :service_provider_id, ServiceProvider.where(location_id: Location.where(company_id: current_user.company_id).actives).accessible_by(current_ability).ordered, :id, :public_name, {}, { class: "form-control" }%>
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                          <div class="checkbox">
                            <label>
                              <%= f.check_box :provider_lock %>Prestador seleccionado por cliente
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="form-group has-feedback">
                        <%= f.label :service, "Servicio", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <select id="booking_service_id" name="booking[service_id]" class="form-control"></select>
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                        </div>
                      </div>
                      <div id="bundle_service_providers">
                      </div>
                      <div class="form-group has-feedback">
                        <%= f.label :price, "Precio", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <%= f.number_field :price, min: 0, class: "form-control" %>
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                        </div>
                      </div>
                      <div class="form-group has-feedback" id="treatment_price_div">
                        <%= f.label "treatment_price", "Precio tratamiento", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8" style="padding-top: 7px;">
                          <span id="treatment_price"></span>
                        </div>
                      </div>
                      <div class="form-group has-feedback" id="payed_state_select_div">
                        <%= f.label :payed_state, "Pagado", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <select id="booking_payed_state" class="form-control" name="booking[payed_state]">
                            <option value="0">No</option>
                            <option value="1">SÃ­</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-group has-feedback" id="payed_state_fixed_div">
                        <label class="col-sm-4 control-label">Pagado</label>
                        <div class="col-sm-8" style="padding-top: 7px;">
                          <span id="payed_state_fixed"></span>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <% if @booking.client.nil? then @booking.build_client end %>
                      <%= f.fields_for :client do |builder| %>
                        <%= content_tag "div", id: "client_exclusive_data", data: { client_exclusive: @company_setting.client_exclusive } do %>
                        <% end %>
                        <% if @company_setting.client_exclusive || @company_setting.use_identification_number %>
                        <div class="form-group has-feedback has-feedback">
                          <%= builder.label :identification_number, (I18n.t('ci')).capitalize, class: "col-sm-4 control-label" %>
                          <div class="col-sm-8">
                            <%= builder.text_field :identification_number, class: "form-control", disabled: @company_setting.client_exclusive %>
                            <span class="help-block"></span>
                            <ul id="rut_suggestions"></ul>
                          </div>
                        </div>
                        <% end %>
                        <div class="form-group has-feedback">
                          <label for="full_name" class="col-sm-4 control-label">Nombre cliente</label>
                          <div class="col-sm-8">
                            <div class="input-group">
                              <input type="text" id="full_name" class="form-control" placeholder="Buscar clientes..." name="full_name">
                              <span class="input-group-btn">
                                <button class="btn btn-red" type="button" id="xButton"><i class="fa fa-times-circle"></i></button>
                              </span>
                            </div>
                            <span class="help-block"></span>
                            <ul id="full_name_suggestions"></ul>
                          </div>
                        </div>
                        <div class="form-group">
                          <%= builder.label :email, "E-mail", class: "col-sm-4 control-label" %>
                          <div class="col-sm-8">
                            <%= builder.text_field :email, class: "form-control" %>
                            <ul id="email_suggestions"></ul>
                            <div class="checkbox">
                              <label>
                                <%= f.check_box :send_mail, :disabled => true %>Notificar cliente por e-mail
                              </label>
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <%= builder.label :phone, "TelÃ©fono", class: "col-sm-4 control-label" %>
                          <div class="col-sm-8">
                            <%= builder.text_field :phone, class: "form-control" %>
                          </div>
                        </div>
                      <% end %>
                      <% if current_user.role_id != Role.find_by_name("Staff").id %>
                        <div class="form-group" style="margin-top: 5px;">
                          <div class="col-sm-4">
                          &nbsp;
                          </div>
                          <div class="col-sm-8">
                            <a href='/clients' class='open_client_link' target='_blank'>Ir a fichas de clientes</a>
                          </div>
                        </div>
                      <% else %>
                        <div class="form-group" style="margin-top: 5px;">
                          <div class="col-sm-4">
                            &nbsp;
                          </div>
                          <div class="col-sm-8">
                            <a href='#' class='open_client_link staff_client_link' target='_blank'>Ir a ficha del cliente</a>
                          </div>
                        </div>
                      <% end %>
                      <% if @company_setting.allows_online_payment %>
                      <div class="form-group">
                        <%= f.label :payed, "Pagado en lÃ­nea", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <p class="form-control-static" id="is_prepayed">
                          </p>
                        </div>
                      </div>
                      <% end %>
                      <% if true %>
                      <div class="form-group" id="bundled_service">
                        <%= f.label :payed, "Paquete de Servicios", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <p class="form-control-static" id="is_bundle">
                          </p>
                        </div>
                      </div>
                      <% end %>
                      <div class="form-group">
                        <%= f.label :status_id, "Estado", class: "col-sm-4 control-label" %>
                        <div class="col-sm-8">
                          <%= f.collection_select :status_id, Status.all.order(:name), :id, :name, {selected: Status.find_by_name( 'Reservado').id}, { class: "form-control" }%>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row" id="sessions-row" hidden>
                    <input type="hidden" name="has_sessions" id="has_sessions" value="0" />
                    <div class="col-md-12">
                      <div class="form-group">
                        <%= f.label "sessions-label", "Sesiones", class: "col-sm-2 control-label" %>
                        <div class="col-sm-10">
                          <div id="sessions-info" style="padding-top: 7px;">

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <%= f.label :notes, "Notas compartidas con cliente", class: "col-sm-2 control-label" %>
                        <div class="col-sm-10">
                          <%= f.text_area :notes, :rows => "2", class: "form-control modal-textarea" %>
                        </div>
                      </div>
                      <div class="form-group">
                        <%= f.label :company_comment, "Comentario interno", class: "col-sm-2 control-label" %>
                        <div class="col-sm-10">
                          <%= f.text_area :company_comment, :rows => "2", class: "form-control modal-textarea" %>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% if @company_setting.staff_code %>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group has-feedback">
                        <%= label_tag :booking_employee_code, "CÃ³digo de Empleado", class: "col-sm-2 control-label" %>
                        <div class="col-sm-10">
                          <%= password_field_tag :booking_employee_code, '',{class: "form-control", required: true} %>
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% end %>
                  <% if @company_setting.deal_activate %>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group has-feedback">
                        <%= label_tag :booking_deal_code, "CÃ³digo de Convenio", class: "col-sm-2 control-label" %>
                        <div class="col-sm-10">
                          <%= text_field_tag :booking_deal_code, '',{class: "form-control", required: true} %>
                          <span class="help-block"></span>
                          <span class="form-control-feedback"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% end %>
                  <% if @company.is_plan_capable("Premium") %>
                    <% if @company.custom_attributes.where(show_on_calendar: true).count > 0 %>
                      <div class="row">
                        <div class="col-md-12">
                          <div style="font-size: 18px; padding: 10px; border-bottom: 1px solid #505050;">
                            Campos personalizados adicionales
                          </div>
                        </div>
                      </div>
                    <% end %>
                    <% @company.attribute_groups.order(:order).each do |attribute_group| %>
                      <% if attribute_group.custom_attributes.where(show_on_calendar: true).count > 0 %>
                        <div class="row">
                          <div class="col-md-12">
                            <div style="font-size: 16px; padding-left: 10px; padding-top: 5px;">
                              <%= attribute_group.name %>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <% attribute_group.custom_attributes.where(show_on_calendar: true).order(:order).each do |attribute| %>
                            <%
                              if attribute.datatype == "file" || (attribute.datatype == "categoric" && (attribute.attribute_categories.nil? || attribute.attribute_categories.count < 1))
                                next
                              end
                            %>
                            <div class="col-md-6">
                              <% if attribute.datatype == "float" %>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <input type="number" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                        <span class="help-block"><%= attribute.description %></span>
                                        <span class="form-control-feedback"></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              <% elsif attribute.datatype == "integer" %>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <input type="number" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                        <span class="help-block"><%= attribute.description %></span>
                                        <span class="form-control-feedback"></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              <% elsif attribute.datatype == "text" %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <input type="text" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                        <span class="help-block"><%= attribute.description %></span>
                                        <span class="form-control-feedback"></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                              <% elsif attribute.datatype == "textarea" %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <textarea class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" <%= "required" if attribute.mandatory_on_calendar %> /></textarea>
                                        <span class="help-block"><%= attribute.description %></span>
                                        <span class="form-control-feedback"></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                              <% elsif attribute.datatype == "boolean" %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute">
                                            <option value="1" selected>SÃ­</option>
                                            <option value="0">No</option>
                                        </select>
                                        <span class="help-block"><%= attribute.description %></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                              <% elsif attribute.datatype == "date" %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                      <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                        <%= attribute.name %>
                                      </label>
                                      <div class="col-sm-8">
                                        <input type="text" class="form-control attribute_datepicker custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                        <span class="help-block"><%= attribute.description %></span>
                                        <span class="form-control-feedback"></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                              <% elsif attribute.datatype == "datetime" %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group">
                                    <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                      <%= attribute.name %>
                                    </label>
                                    <div class="col-sm-8" style="padding: 0px !important;">
                                      <div class="col-sm-12">
                                        <input type="text" class="form-control attribute_datepicker custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                      </div>
                                      <div class="col-sm-5" style="padding-right: 0px !important;">
                                        <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute_hour" id="<%= attribute.slug %>_attribute_hour">
                                          <%
                                            for i in 0..23
                                              str_hour = i.to_s
                                              if str_hour.length == 1
                                                str_hour = "0" + str_hour
                                              end

                                              %>
                                                <option value="<%= str_hour %>"><%= str_hour %></option>
                                              <%

                                            end
                                          %>
                                        </select>
                                      </div>
                                      <div class="col-sm-2">
                                      :
                                      </div>
                                      <div class="col-sm-5" style="padding-left: 0px !important;">
                                        <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute_minute" id="<%= attribute.slug %>_attribute_minute">
                                          <%
                                            for i in 0..59
                                              str_minute = i.to_s
                                              if str_minute.length == 1
                                                str_minute = "0" + str_minute
                                              end

                                              %>
                                                <option value="<%= str_minute %>"><%= str_minute %></option>
                                              <%

                                            end
                                          %>
                                        </select>
                                      </div>
                                      <span class="help-block"><%= attribute.description %></span>
                                      <span class="form-control-feedback"></span>
                                    </div>
                                  </div>
                                  </div>
                                </div>

                              <% elsif attribute.datatype == "categoric" && !attribute.attribute_categories.nil? && attribute.attribute_categories.count > 0 %>

                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group has-feedback">
                                    <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                      <%= attribute.name %>
                                    </label>
                                    <div class="col-sm-8">
                                      <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute">
                                        <% attribute.attribute_categories.each do |category| %>
                                          <option value="<%= category.id %>"><%= category.category %></option>
                                        <% end %>
                                      </select>
                                      <span class="help-block"><%= attribute.description %></span>
                                    </div>
                                  </div>
                                  </div>
                                </div>

                              <% end %>
                            </div>

                          <% end %>
                        </div>
                      <% end %>
                    <% end %>
                  <% end %>


                <% end %>
                </div>
                <div class="tab-pane" id="client-pane">
                  <div class="row">
                    <div class="col-md-2">
                      <ul id="client-attributes-tab" class="nav nav-pills nav-stacked" role="tablist">
                        <li id="client-attributes-0-li" class="active booking-client-li"><a href="#client-attributes-0" role="tab" data-toggle="tab" class="client_tab_index" id="client-attributes-0-tab">Datos personales</a></li>
                        <% @company.attribute_groups.each do |attribute_group| %>
                          <% if attribute_group.custom_attributes.where(show_on_calendar: false).count > 0 %>
                            <li id="client-attributes<%= attribute_group.id %>-li" class="booking-client-li"><a href="#client-attributes-<%= attribute_group.id %>" role="tab" data-toggle="tab" class="client_tab_index" id="client-attributes-<%= attribute_group.id %>-tab"><%= attribute_group.name %></a></li>
                          <% end %>
                        <% end %>


                      </ul>
                      <% if current_user.role_id != Role.find_by_name("Staff").id %>
                        <div class="form-group" style="margin-top: 5px; width: 100%;">
                          <a href='/clients' class='open_client_link' target='_blank'>Ir a fichas de clientes</a>
                        </div>
                      <% else %>
                        <div class="form-group" style="margin-top: 5px; width: 100%;">
                          <a href='#' class='open_client_link staff_client_link' target='_blank'>Ir a ficha del cliente</a>
                        </div>
                      <% end %>
                    </div>
                    <div class="col-md-10">
                      <%= form_for @booking, html: {class: "form-horizontal"} do |f| %>
                        <%= f.fields_for :client do |builder| %>

                          <div id="clientTabContent" class="tab-content">
                            <div class="tab-pane active" id="client-attributes-0">

                              <div class="row">
                                <div class="col-md-6">
                                  <%= builder.hidden_field :id %>
                                  <div class="form-group">
                                    <%= builder.label :first_name, "Nombre", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :first_name, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :last_name, "Apellido", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :last_name, class: "form-control" %>
                                    </div>
                                  </div>
                                  <% unless @company_setting.client_exclusive || @company_setting.use_identification_number %>
                                  <div class="form-group has-feedback">
                                    <%= builder.label :identification_number, (I18n.t('ci')).capitalize, class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :identification_number, class: "form-control" %>
                                      <span class="help-block"></span>
                                      <span class="form-control-feedback"></span>
                                    </div>
                                  </div>
                                  <% end %>
                                  <div class="form-group">
                                    <%= builder.label :birth_day, "CumpleaÃ±os", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-2">
                                      <%= builder.select :birth_day, [['01',1], ['02',2], ['03',3], ['04',4], ['05',5], ['06',6], ['07',7], ['08',8], ['09',9], ['10',10], ['11',11], ['12',12], ['13',13], ['14',14], ['15',15], ['16',16], ['17',17], ['18',18], ['19',19], ['20',20], ['21',21], ['22',22], ['23',23], ['24',24], ['25',25], ['26',26], ['27',27], ['28',28], ['29',29], ['30',30], ['31',31]], {prompt: "DÃ­a"}, { class: "form-control date-select"} %>
                                    </div>
                                    <div class="col-sm-3">
                                      <%= builder.select :birth_month, [['Enero',1], ['Febrero',2], ['Marzo',3], ['Abril',4], ['Mayo',5], ['Junio',6], ['Julio',7], ['Agosto',8], ['Septiembre',9], ['Octubre',10], ['Noviembre',11], ['Diciembre',12]], {prompt: "Mes"}, { class: "form-control date-select"} %>
                                    </div>
                                    <div class="col-sm-2">
                                      <%= builder.select :birth_year, options_for_select(Time.now.year.downto(Time.now.year-100).map {|s| ["#{s}", s]}), {prompt: "AÃ±o"}, { class: "form-control date-select"} %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :age, "Edad", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.number_field :age, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :gender, "GÃ©nero", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.select :gender, [['No especificado',0], ['Femenino',1], ['Masculino',2]], { }, { class: "form-control"} %>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group">
                                    <%= builder.label :address, "DirecciÃ³n", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :address, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :district, (I18n.t('district')).capitalize, class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :district, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :city, "Ciudad", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :city, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :second_phone, "TelÃ©fono 2", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :second_phone, class: "form-control" %>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <%= builder.label :record, "NÃºmero de Cliente", class: "col-sm-4 control-label" %>
                                    <div class="col-sm-8">
                                      <%= builder.text_field :record, class: "form-control" %>
                                    </div>
                                  </div>

                                </div>
                              </div>
                            </div>

                            <!--
                              Custom attributes that are not to be shown in calendar
                            -->
                            <% if @company.is_plan_capable("Premium") %>
                              <% @company.attribute_groups.order(:order).each do |attribute_group| %>
                                <% if attribute_group.custom_attributes.where(show_on_calendar: false).count > 0 %>
                                  <div class="tab-pane" id="client-attributes-<%= attribute_group.id %>">
                                    <div class="row">

                                      <% attribute_group.custom_attributes.where(show_on_calendar: false).each do |attribute| %>

                                        <%
                                          if attribute.datatype == "file" || (attribute.datatype == "categoric" && (attribute.attribute_categories.nil? || attribute.attribute_categories.count < 1))
                                            next
                                          end
                                        %>

                                        <div class="col-md-6">
                                          <% if attribute.datatype == "float" %>
                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <input type="number" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                                    <span class="help-block"><%= attribute.description %></span>
                                                    <span class="form-control-feedback"></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          <% elsif attribute.datatype == "integer" %>
                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <input type="number" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                                    <span class="help-block"><%= attribute.description %></span>
                                                    <span class="form-control-feedback"></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          <% elsif attribute.datatype == "text" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <input type="text" class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                                    <span class="help-block"><%= attribute.description %></span>
                                                    <span class="form-control-feedback"></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>

                                          <% elsif attribute.datatype == "textarea" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <textarea class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" <%= "required" if attribute.mandatory_on_calendar %> /></textarea>
                                                    <span class="help-block"><%= attribute.description %></span>
                                                    <span class="form-control-feedback"></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>

                                          <% elsif attribute.datatype == "boolean" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute">
                                                        <option value="1" selected>SÃ­</option>
                                                        <option value="0">No</option>
                                                    </select>
                                                    <span class="help-block"><%= attribute.description %></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>

                                          <% elsif attribute.datatype == "date" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                  <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                    <%= attribute.name %>
                                                  </label>
                                                  <div class="col-sm-8">
                                                    <input type="text" class="form-control attribute_datepicker custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                                    <span class="help-block"><%= attribute.description %></span>
                                                    <span class="form-control-feedback"></span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>

                                          <% elsif attribute.datatype == "datetime" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group">
                                                <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                  <%= attribute.name %>
                                                </label>
                                                <div class="col-sm-8" style="padding: 0px !important;">
                                                  <div class="col-sm-12">
                                                    <input type="text" class="form-control attribute_datepicker custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute" value="" <%= "required" if attribute.mandatory_on_calendar %> />
                                                  </div>
                                                  <div class="col-sm-5" style="padding-right: 0px;">
                                                    <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute_hour" id="<%= attribute.slug %>_attribute_hour">
                                                      <%
                                                        for i in 0..23
                                                          str_hour = i.to_s
                                                          if str_hour.length == 1
                                                            str_hour = "0" + str_hour
                                                          end

                                                          %>
                                                            <option value="<%= str_hour %>"><%= str_hour %></option>
                                                          <%

                                                        end
                                                      %>
                                                    </select>
                                                  </div>
                                                  <div class="col-sm-2">
                                                  :
                                                  </div>
                                                  <div class="col-sm-5" style="padding-left: 0px;">
                                                    <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute_minute" id="<%= attribute.slug %>_attribute_minute">
                                                      <%
                                                        for i in 0..59
                                                          str_minute = i.to_s
                                                          if str_minute.length == 1
                                                            str_minute = "0" + str_minute
                                                          end

                                                          %>
                                                            <option value="<%= str_minute %>"><%= str_minute %></option>
                                                          <%

                                                        end
                                                      %>
                                                    </select>
                                                  </div>
                                                  <span class="help-block"><%= attribute.description %></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>
                                              </div>
                                            </div>

                                          <% elsif attribute.datatype == "categoric" %>

                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                <label for="<%= attribute.slug %>_attribute" class="col-sm-4 control-label">
                                                  <%= attribute.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <select class="form-control custom-attribute" name="<%= attribute.slug %>_attribute" id="<%= attribute.slug %>_attribute">
                                                    <% attribute.attribute_categories.each do |category| %>
                                                      <option value="<%= category.id %>"><%= category.category %></option>
                                                    <% end %>
                                                  </select>
                                                  <span class="help-block"><%= attribute.description %></span>
                                                </div>
                                              </div>
                                              </div>
                                            </div>

                                          <% end %>
                                        </div>
                                      <% end %>

                                    </div>
                                  </div>
                                <% end %>
                              <% end %>

                            <% end %>
                          </div>
                        <% end %>
                      <% end %>
                      <!--<p><strong>Nota:</strong> Si modificas estos datos, al guardar la reserva, se actualizarÃ¡n los datos del cliente.</p>-->
                    </div>
                  </div>
                </div>

                <div class="tab-pane" id="charts-pane">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="checkbox" style="padding-left: 15px;">
                          <label>
                            <input type="checkbox" name="chart[create_chart]" id="create_chart" value="0" />Crear o actualizar ficha asociada a esta reserva
                          </label>
                          <span class="create_chart_explanation" style="color: #22c488;" title="Advertencia: Si existe una ficha asociada a esta reserva, desmarcas esta opciÃ³n y luego guardas, la ficha seÇµuirÃ¡ existiendo pero ya no estarÃ¡ asociada a la reserva.">&nbsp;&nbsp;<i class="fa fa-question-circle"></i></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-2">
                    <ul id="client-chart-fields-tab" class="nav nav-pills nav-stacked" role="tablist">
                      <li id="client-chart-general-li" class="booking-client-li active"><a href="#chart-general" role="tab" data-toggle="tab" class="client_tab_index">General</a></li>
                      <% @company.chart_groups.each_with_index do |chart_group, index| %>
                        <% if chart_group.chart_fields.count > 0 %>
                          <li id="client-chart-fields<%= chart_group.id %>-li" class="booking-client-li"><a href="#client-chart-fields-<%= chart_group.id %>" role="tab" data-toggle="tab" class="client_tab_index" id="client-chart-fields-<%= chart_group.id %>-tab"><%= chart_group.name %></a></li>
                        <% end %>
                      <% end %>


                    </ul>
                  </div>
                  <div class="col-md-10">



                        <div id="clientTabContent" class="tab-content">

                          <div class="tab-pane active" id="chart-general">

                            <div class="form-group">
                              <label for="chart_date" class="col-xs-2 col-md-2 control-label left-label">Fecha</label>
                              <div class="col-xs-4 col-md-4">
                                <input type="hidden" name="chart[client_id]" id="chart_client_id" value="" />
                                <input type="hidden" name="chart[company_id]" id="chart_company_id" value="<%= current_user.company_id %>" />
                                <input type="hidden" name="chart[user_id]" id="chart_user_id" value="" />
                                <input type="hidden" name="chart[last_modifier_id]" id="chart_last_modifier_id" value="<%= current_user.id %>" />
                                <input type="hidden" name="chart[date]" id="chart_date" value="" />
                                <input type="text" class="form-control chart_field_datepicker" id="aux_date" value="<%= (DateTime.now + @company.country.timezone_offset.hours).strftime('%d/%m/%Y') %>" autocomplete="off" />
                              </div>
                              <div class="col-xs-4" style="text-align: right;">
                                <select class="form-control" style="width: 45% !important; display: inline;" id="aux_hour">
                                  <%
                                    for i in 0..23
                                      str_hour = i.to_s
                                      if str_hour.length == 1
                                        str_hour = "0" + str_hour
                                      end

                                      %>
                                        <option value="<%= str_hour %>"><%= str_hour %></option>
                                      <%

                                    end
                                  %>
                                </select>
                                &nbsp;:&nbsp;
                                <select class="form-control" style="width: 45% !important; display: inline;" id="aux_minute">
                                  <%
                                    for i in 0..59
                                      str_hour = i.to_s
                                      if str_hour.length == 1
                                        str_hour = "0" + str_hour
                                      end

                                      %>
                                        <option value="<%= str_hour %>"><%= str_hour %></option>
                                      <%

                                    end
                                  %>
                                </select>
                              </div>
                              <div class="col-xs-2">

                              </div>

                            </div>

                          </div>

                          <!--
                            Chart fields
                          -->

                            <% @company.chart_groups.order(:order).each_with_index do |chart_group, index| %>
                              <% if chart_group.chart_fields.count > 0 %>
                                <div class="tab-pane charts-pane" id="client-chart-fields-<%= chart_group.id %>">


                                    <% chart_group.chart_fields.order(:order).each do |chart_field| %>

                                      <%
                                        if (chart_field.datatype == "categoric" && (chart_field.chart_categories.nil? || chart_field.chart_categories.count < 1)) || chart_field.datatype == "file"
                                          next
                                        end
                                      %>

                                      <div class="col-md-6">

                                        <% if chart_field.datatype == "float" %>

                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <input type="number" class="form-control chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" value="" <%= "required" if chart_field.mandatory %> />
                                                  <span class="help-block"></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>

                                        <% elsif chart_field.datatype == "integer" %>

                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <input type="number" class="form-control chart-field" title="<%= chart_field.description %>" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" value="" <%= "required" if chart_field.mandatory %> />
                                                  <span class="help-block"></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>

                                        <% elsif chart_field.datatype == "text" %>


                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <input type="text" class="form-control chart-field" title="<%= chart_field.description %>" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" value="" <%= "required" if chart_field.mandatory %> />
                                                  <span class="help-block"></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>


                                        <% elsif chart_field.datatype == "textarea" %>


                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <textarea class="form-control chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" <%= "required" if chart_field.mandatory %> /></textarea>
                                                  <span class="help-block"></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>


                                        <% elsif chart_field.datatype == "boolean" %>


                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <select class="form-control chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field">
                                                      <option value="1" selected>SÃ­</option>
                                                      <option value="0">No</option>
                                                  </select>
                                                  <span class="help-block"></span>
                                                </div>
                                              </div>


                                        <% elsif chart_field.datatype == "date" %>


                                              <div class="form-group has-feedback">
                                                <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                  <%= chart_field.name %>
                                                </label>
                                                <div class="col-sm-8">
                                                  <input type="text" class="form-control chart_field_datepicker chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" value="" <%= "required" if chart_field.mandatory %> />
                                                  <span class="help-block"></span>
                                                  <span class="form-control-feedback"></span>
                                                </div>
                                              </div>


                                        <% elsif chart_field.datatype == "datetime" %>


                                            <div class="form-group">
                                              <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                <%= chart_field.name %>
                                              </label>
                                              <div class="col-sm-8" style="padding: 0px !important;">
                                                <div class="col-sm-12">
                                                  <input type="text" class="form-control chart_field_datepicker chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field" value="" <%= "required" if chart_field.mandatory %> />
                                                </div>
                                                <div class="col-sm-5" style="padding-right: 0px;">
                                                  <select class="form-control chart-field" name="<%= chart_field.slug %>_chart_field_hour" id="<%= chart_field.slug %>_chart_field_hour">
                                                    <%
                                                      for i in 0..23
                                                        str_hour = i.to_s
                                                        if str_hour.length == 1
                                                          str_hour = "0" + str_hour
                                                        end

                                                        %>
                                                          <option value="<%= str_hour %>"><%= str_hour %></option>
                                                        <%

                                                      end
                                                    %>
                                                  </select>
                                                </div>
                                                <div class="col-sm-2">
                                                :
                                                </div>
                                                <div class="col-sm-5" style="padding-left: 0px;">
                                                  <select class="form-control chart-field" name="<%= chart_field.slug %>_chart_field_minute" id="<%= chart_field.slug %>_chart_field_minute">
                                                    <%
                                                      for i in 0..59
                                                        str_minute = i.to_s
                                                        if str_minute.length == 1
                                                          str_minute = "0" + str_minute
                                                        end

                                                        %>
                                                          <option value="<%= str_minute %>"><%= str_minute %></option>
                                                        <%

                                                      end
                                                    %>
                                                  </select>
                                                </div>
                                                <span class="help-block"><%= chart_field.description %></span>
                                                <span class="form-control-feedback"></span>
                                              </div>
                                            </div>


                                        <% elsif chart_field.datatype == "categoric" %>


                                            <div class="form-group has-feedback">
                                              <label for="<%= chart_field.slug %>_chart_field" title="<%= chart_field.description %>" class="col-sm-4 control-label">
                                                <%= chart_field.name %>
                                              </label>
                                              <div class="col-sm-8">
                                                <select class="form-control chart-field" name="<%= chart_field.slug %>_chart_field" id="<%= chart_field.slug %>_chart_field">
                                                  <% chart_field.chart_categories.each do |category| %>
                                                    <option value="<%= category.id %>"><%= category.name %></option>
                                                  <% end %>
                                                </select>
                                                <span class="help-block"></span>
                                              </div>
                                            </div>


                                        <% end %>
                                      </div>
                                    <% end %>


                                </div>
                              <% end %>
                            <% end %>


                        </div>


                    <!--<p><strong>Nota:</strong> Si modificas estos datos, al guardar la reserva, se actualizarÃ¡n los datos del cliente.</p>-->
                  </div>
                </div>

                <div class="tab-pane" id="history-pane">
                  <div class="fixed-table">
                    <h4>Ãltimas atenciones del cliente:</h4>
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Fecha de atenciÃ³n</th>
                          <th>Fecha de creaciÃ³n</th>
                          <th>Servicio</th>
                          <th>Prestador</th>
                          <th>Estado</th>
                          <th>Nota Cliente</th>
                          <th>Nota Interna</th>
                        </tr>
                      </thead>
                      <tbody id="client-history1-tbody">
                        <tr>
                          <td colspan="6">No hay un cliente seleccionado...</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="fixed-table">
                    <h4>Ãltimas creaciones de reservas del cliente:</h4>
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Fecha de creaciÃ³n</th>
                          <th>Fecha de atenciÃ³n</th>
                          <th>Servicio</th>
                          <th>Prestador</th>
                          <th>Estado</th>
                          <th>Nota Cliente</th>
                          <th>Nota Interna</th>
                        </tr>
                      </thead>
                      <tbody id="client-history2-tbody">
                        <tr>
                          <td colspan="6">No hay un cliente seleccionado...</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <% if @company_setting.booking_history %>
                <div class="tab-pane" id="changes-pane">
                  <div class="fixed-table">
                    <h4>Modificaciones a la Reserva:</h4>
                    <table class="table">
                      <thead>
                        <tr>
                          <th>AcciÃ³n</th>
                          <th>Fecha</th>
                          <th>Reserva</th>
                          <th>Servicio</th>
                          <th>Prestador</th>
                          <th>Estado</th>
                          <th>Nota</th>
                          <th>N. Interna</th>
                          <th>Usuario</th>
                          <% if @company_setting.staff_code %>
                          <th>Responsable</th>
                          <% end %>
                        </tr>
                      </thead>
                      <tbody id="booking-history-tbody">
                        <tr>
                          <% if @company_setting.staff_code %>
                          <td colspan="9">No hay modificaciones para esta reserva...</td>
                          <% else %>
                          <td colspan="8">No hay modificaciones para esta reserva...</td>
                          <% end %>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="fixed-table">
                    <h4>Correos al cliente:</h4>
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Estado</th>
                          <th>Fecha</th>
                          <th>Asunto</th>
                          <th>Email</th>
                          <th>Visualizaciones</th>
                          <th>Clicks</th>
                        </tr>
                      </thead>
                      <tbody id="booking-email-tbody">
                        <tr>
                          <td colspan="6">No hay correos enviados para esta reserva...</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <% end %>
                <div class="tab-pane" id="client-payments-pane">
                  <div class="row">
                    <div class="col-xs-12">
                      <h4>Ãltimos pagos del cliente (mÃ¡x. 10 pagos):</h4>
                    </div>
                  </div>
                  <div id="client-payments-div">
                    <p>No hay un cliente seleccionado...</p>
                  </div>
                </div>
                <div class="tab-pane" id="payments-pane">
                  <input type="hidden" id="paymentBookingId" value="" />
                  <div class="row" id="bookingPaymentEdit" style="padding-left: 12px; padding-right: 10px;" hidden>

                    <div class="row">
                      <div class="col-xs-12">
                        <% if current_user.role == Role.find_by_name("Recepcionista") %>
                          <p>Esta reserva ya tiene asociada un pago. Ponte en contacto con el administrador de tu local si necesitas editar o borrar el pago.</p>
                        <% else %>
                          <button style="width: 150px; margin-right: 5px;" id="bookingPaymentEditBtn" class="edit-option-btn btn btn-default">
                            <i class="fa fa-pencil-square-o"></i>Editar pago
                          </button>
                          <button style="width: 150px;" id="bookingPaymentDeleteBtn" class="edit-option-btn btn btn-red">
                            <i class="fa fa-times"></i>Eliminar pago
                          </button>
                        <% end %>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xs-12">
                        <div id="bookingPaymentSummary" style="padding-left: 15px; padding-right: 15px;">

                        </div>
                      </div>
                    </div>

                  </div>
                  <div class="row" id="bookingPaymentCreate" hidden>
                    <div class="col-xs-12">
                      <h4>Agrega un pago a la reserva.</h4>
                      <button id="bookingPaymentCreateBtn" class="edit-option-btn btn btn-green" style="max-width: 200px; min-width: 120px;">
                        <i class="fa fa-plus"></i>&nbsp;Agregar pago
                      </button>
                    </div>
                    <div class="col-xs-12" id="past-payments-wrapper" style="margin-top: 5px; padding-top: 5px;">
                      <h4 style="border-top: 1px solid #949292; padding-top: 8px;">Asociar a un pago existente de este servicio.&nbsp;<span class="create_chart_explanation" style="color: #22c488;" title="Si el cliente tiene un Pago que incluya este servicio sin una reserva, puedes reemplazarlo por esta reserva haciendo click en Asociar a este pago.">&nbsp;&nbsp;<i class="fa fa-question-circle"></i></span></h4> 
                      <div id="past-payments">

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <div class="modal-footer booking-modal-footer">
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="breakModal" tabindex="-1" role="dialog" aria-labelledby="breakModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title break-modal-title" id="breakModalLabel">Bloquear Horas o Agregar Vacaciones</h4>
        </div>
        <div class="modal-body break-modal-body">
          <div id="break-loader" hidden>
            <p style="text-align: center; margin-top: 50px;">
              <%= image_tag "ajax-loader.gif", :alt => "Loader" %>
            </p>
          </div>
          <%= form_for @provider_break, html: {class: "form-horizontal"} do |f| %>
            <input type="hidden" id="provider_break_repeat_id" name="provider_break_repeat_id" value="" />
            <div class="form-group">
              <%= f.label :service_provider_id, "Prestadores de Servicios", class: "col-sm-3 control-label" %>
              <div class="col-sm-9">
                <div id="providers_checkboxes">
                  <%= f.collection_check_boxes :service_provider_id, ServiceProvider.where(location_id: Location.where(company_id: current_user.company_id, :active => true)).accessible_by(current_ability), :id, :public_name, {}, { class: "check_boxes providers_check_boxes" } do |b|%>
                    <div class="checkbox">
                      <label>
                        <%= b.check_box %> <%= b.object.public_name.html_safe %>
                      </label>
                    </div>
                  <% end %>
                </div>
                <div id="providers_multiselect_div">
                  <select id="serviceProvidersMultiSelect" multiple="multiple" style="margin-top: 7px;" hidden>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :name, "Etiqueta", class: "col-sm-3 control-label" %>
              <div class="col-sm-9">
                <%= f.text_field :name,  class: "form-control" %>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :start, "Inicio", class: "col-sm-3 control-label" %>
              <div class="col-sm-9">
                <%= f.datetime_select :start, {default: @timezone.offset.ago, :minute_step => 5}, {class: "form-control date-select"} %>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :end, "Fin", class: "col-sm-3 control-label" %>
              <div class="col-sm-9">
                <%= f.datetime_select :end, {default: @timezone.offset.ago, :minute_step => 5}, {class: "form-control date-select"} %>
              </div>
            </div>
            <div class="form-group form-repeat-div">
              <label class="col-sm-3 control-label">
                RepeticiÃ³n
              </label>
              <div class="col-sm-9">
                Define el esquema de repeticiÃ³n, eligiendo la cantidad de veces o la fecha de tÃ©rmino.
              </div>
            </div>
            <div class="form-group form-repeat-div">
              <label class="col-sm-3 control-label">
                Repetir
              </label>
              <div class="col-sm-9">
                <select name="repeat" id="break_repeat" class="form-control">
                  <option value="never">
                    Nunca
                  </option>
                  <option value="daily">
                    Diariamente
                  </option>
                  <option value="weekly">
                    Semanalmente
                  </option>
                  <option value="biweekly">
                    Cada 2 semanas
                  </option>
                  <option value="triweekly">
                    Cada 3 semanas
                  </option>
                  <option value="fourthweekly">
                    Cada 4 semanas
                  </option>
                  <option value="xweekly">
                    Cada X semanas
                  </option>
                  <option value="monthly_day">
                    Mensualmente (por dÃ­a)
                  </option>
                  <option value="monthly_date">
                    Mensualmente (por fecha)
                  </option>
                  <option value="yearly">
                    Anualmente (por fecha)
                  </option>
                </select>

              </div>
            </div>
            <div class="form-group form-repeat-div" id="break_repeat_weeks_div" hidden>
              <label class="col-sm-3 control-label">
                Semanas
              </label>
              <div class="col-sm-9">
                <input type="number" id="break_repeat_weeks" name="repeat_weeks" class="form-control" style="margin-top: 10px;" />
              </div>
            </div>
            <div class="form-group form-repeat-div" id="form-repeat-options" hidden>
              <label class="col-sm-3 control-label">
                Finaliza
              </label>
              <div class="col-sm-9">
                <div>
                  <%= radio_button_tag :repeat_option, 'times', true %>&nbsp;DespuÃ©s de un nÃºmero de repeticiones (incluida la original)
                </div>
                <div style="margin: 5px 0 10px;">
                  <%= number_field_tag :break_times, nil,  class: "form-control" %>
                </div>
                <div>
                  <%= radio_button_tag :repeat_option, 'date_end', false %>&nbsp;El&nbsp;
                  <%= datetime_select "provider_break_repeat", "repeat_end", {default: @timezone.offset.ago, :minute_step => 5}, {class: "form-control date-select"} %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
        <div class="modal-footer break-modal-footer">
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="hoursOptimizer" tabindex="-1" role="dialog" aria-labelledby="optimizador de Horas" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="optimizerTitle" style="line-height: 1.1;"></h3>
        </div>
        <div class="modal-body">
          <div id="pickerSelectDate">
            <div class="row">
              <div class="col-xs-2" style="text-align: right; font-weight: bold;">
                Inicio
              </div>
              <div class="col-xs-10">
                <input id="initialPickerDate" value="<%= I18n.l(DateTime.now.to_date) %>" hidden />
                <span id="pickerSelected" style="color: #949292;"><%= I18n.l(DateTime.now.to_date) %></span>&nbsp;&nbsp;
                <span id="optimizer-datepicker-link" class="optimizer-date-span" style="float: right;">
                  Seleccionar nuevo inicio&nbsp;<i class="fa fa-calendar-o"></i>
                  <input type="text" class="form-control" name="optimizerDateSelector" id="optimizerDateSelector" class="datepicker" />
                </span>
              </div>
            </div>
          </div>
          <form class="form-horizontal" id="serviceOptimizer"></form>
          <div id="selectHour"></div>
          <div id="hoursDetails"></div>
          <%= form_for @booking, html: {class: "form-horizontal"} do |f| %>
            <% if @booking.client.nil? then @booking.build_client end %>
            <%= f.fields_for :client do |builder| %>
              <%= builder.hidden_field :id %>
              <%= builder.hidden_field :first_name %>
              <%= builder.hidden_field :last_name %>
              <%= builder.hidden_field :birth_day %>
              <%= builder.hidden_field :birth_month %>
              <%= builder.hidden_field :birth_year %>
              <%= builder.hidden_field :age %>
              <%= builder.hidden_field :gender %>
              <%= builder.hidden_field :address %>
              <%= builder.hidden_field :district %>
              <%= builder.hidden_field :city %>
              <% if @company_setting.use_identification_number %>
                <div class="form-group has-feedback has-feedback">
                  <%= builder.label :identification_number, (I18n.t('ci')).capitalize, class: "col-sm-4 control-label" %>
                  <div class="col-sm-8">
                    <%= builder.text_field :identification_number, class: "form-control", disabled: @company_setting.client_exclusive %>
                    <span class="help-block"></span>
                    <ul id="rut_suggestions"></ul>
                  </div>
                </div>
              <% end %>
              <div class="form-group has-feedback">
                <label for="full_name" class="col-md-4 control-label">Nombre cliente</label>
                <div class="col-md-8">
                  <div class="input-group">
                    <input type="text" id="full_name" class="form-control" placeholder="Buscar clientes..." name="full_name">
                    <span class="input-group-btn">
                      <button class="btn btn-danger" type="button" id="xButton" disabled><i class="fa fa-times-circle"></i></button>
                    </span>
                  </div>
                  <span class="help-block"></span>
                  <ul id="full_name_suggestions"></ul>
                </div>
              </div>
              <div class="form-group">
                <%= builder.label :email, "E-mail", class: "col-md-4 control-label" %>
                <div class="col-md-8">
                  <%= builder.text_field :email, class: "form-control" %>
                  <ul id="email_suggestions"></ul>
                  <div class="checkbox">
                    <label>
                      <%= f.check_box :send_mail, :disabled => true %>Notificar cliente por e-mail
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <%= builder.label :phone, "TelÃ©fono", class: "col-md-4 control-label" %>
                <div class="col-md-8">
                  <%= builder.text_field :phone, class: "form-control" %>
                </div>
              </div>
            <% end %>
            <div class="form-group">
              <%= f.label :status, "Estado", class: "col-md-4 control-label" %>
              <div class="col-md-8">
                <%= f.collection_select :status_id, Status.all.order(:name), :id, :name, {selected: Status.find_by_name( 'Reservado').id}, { class: "form-control" }%>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :notes, "Notas compartidas con cliente", class: "col-md-4 control-label" %>
              <div class="col-md-8">
                <%= f.text_area :notes, :rows => "2", class: "form-control modal-textarea" %>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :company_comment, "Comentario interno", class: "col-md-4 control-label" %>
              <div class="col-md-8">
                <%= f.text_area :company_comment, :rows => "2", class: "form-control modal-textarea" %>
              </div>
            </div>
            <% if @company_setting.staff_code %>
              <div class="form-group has-feedback">
                <%= label_tag :booking_employee_code, "CÃ³digo de Empleado", class: "col-md-4 control-label" %>
                <div class="col-md-8">
                  <%= text_field_tag :booking_employee_code, '',{class: "form-control", required: true} %>
                  <span class="help-block"></span>
                  <span class="form-control-feedback"></span>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-orange pull-left" id="addButton"><i class="fa fa-plus"></i>&nbsp;<span></span></button>
          <button type="button" class="btn btn-dark-green optimizerBtn" id="optimizerPrevButton" hidden><i class="fa fa-chevron-left"></i>&nbsp;AtrÃ¡s</button>
          <button type="button" class="btn btn-green" id="nextButton">Siguiente</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade modalOverModal" id="paymentOverModal" tabindex="-1" role="dialog" aria-labelledby="Modificaciones de Pago" aria-hidden="true">
    <div class="modal-dialog" style="width: auto;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="paymentOverModalTitle" style="line-height: 1.1;">Modificaciones de Pago</h3>
        </div>
        <div class="modal-body" id="paymentOverModalBody">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Cerrar">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade modalOverModal" id="bookingOverModal" tabindex="-1" role="dialog" aria-labelledby="Historial Reserva" aria-hidden="true">
    <div class="modal-dialog" style="width: auto;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="bookingOverModalTitle" style="line-height: 1.1;">Historial Reserva</h3>
        </div>
        <div class="modal-body" id="bookingOverModalBody">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Cerrar">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade modalOverModal" id="clientOverModal" tabindex="-1" role="dialog" aria-labelledby="Historial del Cliente" aria-hidden="true">
    <div class="modal-dialog" style="width: auto;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="clientOverModalTitle" style="line-height: 1.1;">Historial del Cliente</h3>
        </div>
        <div class="modal-body" id="clientOverModalBody">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Cerrar">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade paymentModal" id="paymentSummaryModal" tabindex="-1" role="dialog" aria-labelledby="Resumen de pago" aria-hidden="true">
    <div class="modal-dialog" style="width: 70%;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="paymentSummaryModalTitle" style="line-height: 1.1;">Resumen de pago</h3>
        </div>
        <div class="modal-body" id="paymentSummaryModalBody">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default payment-btn-close" data-dismiss="modal" aria-label="Salir">Salir</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="openDayModal" tabindex="-1" role="dialog" aria-labelledby="Abrir dÃ­a" aria-hidden="true">
    <div class="modal-dialog" style="width: 40%;">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar"><i class="fa fa-times" aria-hidden="true"></i></button>
          <h3 class="modal-title" id="openDayModalTitle" style="line-height: 1.1;">Abrir dÃ­a</h3>
        </div>
        <div class="modal-body" id="openDayModalBody">
          <input type="hidden" id="openDayProviderId" value="" />
          <input type="hidden" id="openDayDate" value="" />
          <p style="margin-left: 15px;">
            Abrir el horario para este prestador entre las siguientes horas:
          </p>
          <div class="form-group">
            <label for="full_name" class="col-md-4 control-label">Inicio</label>
            <div class="col-md-8">
              <table style="width: 70%;">
                <tr>
                  <td style="width: 45%;">
                    <select id="openDayStartHour" name="openDayStartHour" class="form-control">

                    </select>
                  </td>
                  <td style="width: 5%;">
                    :
                  </td>
                  <td style="width: 45%;">
                    <select id="openDayStartMinute" name="openDayStartMinute" class="form-control">
                      
                    </select>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="form-group">
            <label for="full_name" class="col-md-4 control-label">Fin</label>
            <div class="col-md-8">
              <table style="width: 70%;">
                <tr>
                  <td style="width: 45%;">
                    <select id="openDayEndHour" name="openDayEndHour" class="form-control">

                    </select>
                  </td>
                  <td style="width: 5%;">
                    :
                  </td>
                  <td style="width: 45%;">
                    <select id="openDayEndMinute" name="openDayEndMinute" class="form-control">
                      
                    </select>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div style="clear: both;">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default payment-btn-close" data-dismiss="modal" aria-label="Salir">Salir</button>
          <button type="button" class="btn btn-green" id="saveOpenDayBtn">Abrir</button>
        </div>
      </div>
    </div>
  </div>

<% end %>

<%= render :partial => '/payments/payment_modals', :locals => {:company => @company} %>

<% content_for :scripts do %>
  <%= javascript_include_tag "validations/identification_number/" + I18n.locale.to_s %>
  <%= javascript_include_tag "bookings" %>
  <%= javascript_include_tag "validations/admin/payment" %>

	<script type="text/javascript">
    <% if @company_setting.deal_activate && @company_setting.deal_identification_number%>
		$('#booking_deal_code').change(function() {
			var id_string = $('#booking_deal_code').val()
			if (id_string != '') {
				$('#booking_deal_code').val(identification_number_format(id_string));
			}
		});
    <% end %>
    $(function(){

      /*$("#optimizerDateSelector").datepicker({
        dateFormat: 'dd/mm/yy',
        autoSize: true,
        firstDay: 1,
        changeMonth: true,
        changeYear: true,
        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
        monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
        prevText: 'AtrÃ¡s',
        nextText: 'Adelante',
        dayNames: ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'],
        dayNamesShort: ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'],
        dayNamesMin: ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'],
        today: 'Hoy',
        clear: '',
        onSelect: function(newDate){
          $("#pickerSelected").empty();
          console.log(prettyDate);
          var prettyDate = newDate.split("-")[2] + "/" + newDate.split("-")[1] + "/" + newDate.split("-")[0];
          $("#pickerSelected").append(prettyDate);
        },
        beforeShow: function(date) {
          $('#ui-datepicker-div').addClass("customDatepicker");
          $(".customDatepicker .ui-datepicker-calendar").css("width", "214px !important");
        }
      });*/

      $('.modalOverModal').on('show', function() {
        $('#bookingModal').css('opacity', .5);
        $('#bookingModal').unbind();
      });
      $('.modalOverModal').on('hidden', function() {
        $('#bookingModal').css('opacity', 1);
        $('#bookingModal').removeData("modal").modal({});
      });

      $(document.body).on('click', '.optimizer-date-span', function(e){
        $(e.currentTarget).find('input').datepicker('show');
      });
    });
  </script>
<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "fullcalendar_css" %>
  <%= stylesheet_link_tag "admin/bootstrap-multiselect" %>
  <%= stylesheet_link_tag "admin/admin-calendar" %>
<% end %>
